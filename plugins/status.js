
//‚å¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//‚îÉ  ‡ºí ùë´ùë¨ùëΩùë¨ùë≥ùë∂ùë∑ùë¨ùë´ ùë©ùíÄ ùëØùë¨ùëµùëπùíÄ ùë®ùëπùë™ùë®ùëµùëÆùë¨ùë≥ùë∂  ‡ºí
//‚îÉ‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà
//‚îÉ ‚úû‡¶î‡ß£ ùôøùöïùöéùöäùöúùöé ùöåùöõùöéùöçùöíùöù ùöíùöè ùö¢ùöòùöû ùöûùöúùöé ùöùùöëùöé ùöåùöòùöçùöé ‡¶î‡ß£‚úû
//‚îÉ ñ§ç ùòæùô§ùô£ùô©ùôñùôòùô©-ùô¢ùôö ùôõùô§ùôß ùôñùô£ùôÆ ùôôùô§ùô™ùôóùô©
// ‚ï∞‚îÄ...‚å¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

import { performance } from 'perf_hooks';
import osu from 'node-os-utils';
import os from 'os';
import { sizeFormatter } from 'human-readable';
import si from 'systeminformation'; 

// Import


let handler = async (m, { conn, command,  usedPrefix,participants,groupMetadata}) => {
let picture = './media/concept/concept2.jpg'
let name = m.pushName || await conn.getName(m.sender)

const chats = Object.entries(conn.chats).filter(([id, data]) => id && data.isChats)

const groupsIn = chats.filter(([id]) => id.endsWith('@g.us')) //
let _uptime = process.uptime() * 1000
let _muptime
if (process.send) { process.send('uptime')
_muptime = await new Promise(resolve => { process.once('message', resolve) 
setTimeout(resolve, 1000) }) * 1000}



let format = sizeFormatter({
    std: 'JEDEC', // 'SI' (default) | 'IEC' | 'JEDEC'
    decimalPlaces: 2,
    keepTrailingZeroes: false,
    render: (literal, symbol) => `${literal} ${symbol}B`,
});

function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

if (process.send) { process.send('uptime')
_muptime = await new Promise(resolve => { process.once('message', resolve) 
setTimeout(resolve, 2000) }) * 1000}


//await m.eply('_Realizando test_')

    let NotDetect = '--';
    let old = performance.now();
    let cpu = osu.cpu;
    let cpuCore = cpu.count();
    let drive = osu.drive;
    let mem = osu.mem;
    let netstat = osu.netstat;
    let OS = osu.os.platform();
    let cpuModel = cpu.model();
    let cpuPer;
    let p1 = cpu.usage().then((cpuPercentage) => {
        cpuPer = cpuPercentage;
    }).catch(() => {
        cpuPer = NotDetect;
    });
    let driveTotal, driveUsed, drivePer;
    let p2 = drive.info().then((info) => {
        driveTotal = info.totalGb + ' GB';
        driveUsed = info.usedGb;
        drivePer = info.usedPercentage + '%';
    }).catch(() => {
        driveTotal = NotDetect;
        driveUsed = NotDetect;
        drivePer = NotDetect;
    });
    let ramTotal, ramUsed;
    let p3 = mem.info().then((info) => {
        ramTotal = info.totalMemMb;
        ramUsed = info.usedMemMb;
    }).catch(() => {
        ramTotal = NotDetect;
        ramUsed = NotDetect;
    });
    let netsIn, netsOut;
    let p4 = netstat.inOut().then((info) => {
        netsIn = info.total.inputMb + ' MB';
        netsOut = info.total.outputMb + ' MB';
    }).catch(() => {
        netsIn = NotDetect;
        netsOut = NotDetect;
    });

    let systemInfo = await si.system();
    
    let graphicsInfo = await si.graphics();
    let osInfo = await si.osInfo(); 

    let cpuData = await si.cpu();
    let currentLoad = await si.currentLoad();
    let memData = await si.mem();
    let fsSize = await si.fsSize();
    let battery = await si.battery();
    let temperatures = await si.cpuTemperature();
    let networkStats = await si.networkStats();
    let wifiNetworks = await si.wifiNetworks();
    let gpuData = await si.graphics();
console.log(cpuData)
console.log(systemInfo)
console.log(temperatures)

console.log('gpu blw')
console.log(gpuData)
console.log(graphicsInfo)
console.log('netwr')
console.log(networkStats)
    await Promise.all([p1, p2, p3, p4]);

    let osPlatform = osInfo.platform;
    let osRelease = osInfo.release;


const systemLoadPercentage = currentLoad.currentLoad.toFixed(2); 

let banidos = 0;
let silenciados = 0
let avisados = 0

for (let userId in global.db.data.chats[m.chat].users) {
if (global.db.data.chats[m.chat].users[userId].isKicked === true) {
banidos++;
}
if (global.db.data.chats[m.chat].users[userId].silenced === true) {
silenciados++;
}
if (global.db.data.chats[m.chat].users[userId].adv >0) {
avisados++;
}
}



let neww = performance.now()

let speed = neww - old



let fkontak = { "key": { "participants":"0@s.whatsapp.net", "remoteJid": "status@broadcast", "fromMe": false, "id": "Halo" }, "message": { "contactMessage": { "vcard": `BEGIN:VCARD\nVERSION:3.0\nN:Sy;Bot;;;\nFN:y\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabel:Ponsel\nEND:VCARD` }}, "participant": "0@s.whatsapp.net" }
let uptime = clockString(_uptime)

let shell = `${global.heading} journalctl`
let greetTxt = global.db.data.chats[m.chat].language === 'en' ? 
`·¥ús·¥á Ä:`
:
`·¥ús·¥ú·¥Ä Ä…™·¥è:`

let project = `> ///ùó•.ùù£.ùù†.ùó£.ùóò.ùó• P Ä·¥è·¥ä·¥á·¥Ñ·¥õ
> v${vs}`

let isStatus 

if(global.db.data.chats[m.chat].isBanned && global.db.data.chats[m.chat].language == 'pt') {
    isStatus = '‚ö†Ô∏é Ôº¢ÔΩåÔΩèÔΩëÔΩïÔΩÖÔΩÅÔΩÑÔΩè'
  }
  else if(global.db.data.chats[m.chat].isBanned && global.db.data.chats[m.chat].language == 'en') {
    isStatus = '‚ö†Ô∏é Ôº¢ÔΩåÔΩèÔΩÉÔΩãÔΩÖÔΩÑ'
  }
  // inactive
  else if(global.db.data.chats[m.chat].desativado && global.db.data.chats[m.chat].language == 'pt') {
    isStatus = '‚ö†Ô∏é Ôº§ÔΩÖÔΩìÔΩÅÔΩîÔΩâÔΩñÔΩÅÔΩÑÔΩè'
  }
  else if(global.db.data.chats[m.chat].desativado && global.db.data.chats[m.chat].language == 'en') {
    isStatus = '‚ö†Ô∏é Ôº§ÔΩÖÔΩÅÔΩÉÔΩîÔΩâÔΩñÔΩÅÔΩîÔΩÖÔΩÑ'
  }
  //admin
  else if(global.db.data.chats[m.chat].modoadmin && global.db.data.chats[m.chat].language == 'pt') {
    isStatus = '‚ö†Ô∏é Ôº°ÔΩêÔΩÖÔΩéÔΩÅÔΩì ÔΩÅÔΩÑÔΩçÔΩâÔΩé'
  }
  else if(global.db.data.chats[m.chat].modoadmin && global.db.data.chats[m.chat].language == 'en') {
    isStatus = '‚ö†Ô∏é Ôº°ÔΩÑÔΩçÔΩâÔΩé ÔΩèÔΩéÔΩåÔΩô'
  }
  else {
    if(global.db.data.chats[m.chat].language == 'en') {
   isStatus = 'ìâòùÜºìâù ÔºØÔΩéÔΩåÔΩâÔΩéÔΩÖ'
    }
    else if(global.db.data.chats[m.chat].language == 'pt') {
   isStatus = 'ìâòùÜºìâù ÔºØÔΩéÔΩåÔΩâÔΩéÔΩÖ'
    }
  }

let status2 = global.db.data.chats[m.chat].language === 'en' ? 
global.opts['self'] ? 'ùô•ùôßùôûùô´ùôñùô©ùôö' : 'ùô•ùô™ùôóùô°ùôûùôò'
:
global.opts['self'] ? 'ùô•ùôßùôûùô´ùôñùôôùô§' : 'ùô•ùô™ÃÅùôóùô°ùôûùôòùô§'
let botstatus = `[  ô·¥è·¥õ ·¥ç·¥è·¥Ö·¥á: ${status2}` 
let groupstatus = `s·¥õ·¥Ä·¥õ·¥ús: ${isStatus}`
let timeActive  = global.db.data.chats[m.chat].language === 'en' ? 
`> ·ïÄ ·¥ú·¥ò·¥õ…™·¥ç·¥á‚Ü¥
> ${uptime}`
:
`> ·ïÄ ·¥õ·¥á·¥ç·¥ò·¥è ·¥Ä·¥õ…™·¥†·¥è‚Ü¥
> ${uptime}`



 let totalChats =  global.db.data.chats[m.chat].language === 'pt'

      ? 
`> ·ïÄ ·¥õ·¥è·¥õ·¥Ä ü ·¥Ö·¥á ·¥Ñ ú·¥Ä·¥õs: ${chats.length} 
> ·ïÄ ·¥õ·¥è·¥õ·¥Ä ü ·¥Ö·¥á ·¥ús·¥ú·¥ÄÃÅ Ä…™·¥ès: ${Object.keys(global.db.data.users).length} 
> ·ïÄ ·¥õ·¥è·¥õ. ·¥Ñ ú·¥Ä·¥õs ·¥ò Ä…™·¥†·¥Ä·¥Ö·¥ès: ${chats.length - groupsIn.length} | 
> ·ïÄ ·¥õ·¥è·¥õ. ·¥Ñ ú·¥Ä·¥õs  ô·¥Ä…¥…™·¥Ö·¥ès: ${Object.entries(global.db.data.chats).filter(chat => chat[1].isBanned).length} | 
> ·ïÄ ·¥õ·¥è·¥õ. ·¥ús·¥ú·¥Ä Ä.  ô ü·¥è«´·¥ú·¥á·¥Ä·¥Ö·¥ès: ${Object.entries(global.db.data.users).filter(user => user[1].banned).length}`
     
      : 
`> ·ïÄ ·¥õ·¥è·¥õ·¥Ä ü ·¥Ñ ú·¥Ä·¥õs: ${chats.length} 
> ·ïÄ ·¥õ·¥è·¥õ·¥Ä ü ·¥Ö·¥á ·¥ús·¥á Äs: ${Object.keys(global.db.data.users).length} 
> ·ïÄ ·¥õ·¥è·¥õ. ·¥ò Ä…™·¥†·¥Ä·¥õ·¥á ·¥Ñ ú·¥Ä·¥õs: ${chats.length - groupsIn.length} | 
> ·ïÄ ·¥õ·¥è·¥õ.  ô·¥Ä…¥…¥·¥á·¥Ö ·¥Ñ ú·¥Ä·¥õs: ${Object.entries(global.db.data.chats).filter(chat => chat[1].isBanned).length} | 
> ·ïÄ ·¥õ·¥è·¥õ.  ô·¥Ä…¥…¥·¥á·¥Ö ·¥ús·¥á Äs: ${Object.entries(global.db.data.users).filter(user => user[1].banned).length}`
        

let groupStats =   global.db.data.chats[m.chat].language === 'pt'
? 
`> ·ïÄ ·¥ús·¥ú·¥ÄÃÅ Ä…™·¥ès: *${participants.length}*
> ·ïÄ ·¥ús·¥ú·¥ÄÃÅ Ä…™·¥ès s…™ ü·¥á…¥·¥Ñ…™·¥Ä·¥Ö·¥ès: *${silenciados}*
> ·ïÄ ·¥ús·¥ú·¥ÄÃÅ Ä…™·¥ès ·¥Ä·¥Ö·¥†·¥á Ä·¥õ…™·¥Ö·¥ès: *${avisados}* 
> ·ïÄ ·¥ús·¥ú·¥ÄÃÅ Ä…™·¥ès  ô·¥Ä…¥…™·¥Ö·¥ès: *${banidos}*`
: 

`> ·ïÄ ·¥õ·¥è·¥õ·¥Ä ü ·¥ús·¥á Äs: *${participants.length}* 
> ·ïÄ s…™ ü·¥á…¥·¥Ñ·¥á·¥Ö ·¥ús·¥á Äs: *${silenciados}*
> ·ïÄ ·¥°·¥Ä Ä…¥·¥á·¥Ö ·¥ús·¥á Äs: *${avisados}* 
> ·ïÄ  ô ü·¥Ä·¥Ñ·¥ã ü…™s·¥õ ·¥ús·¥á Äs: *${banidos}*`




let systemHeader =  global.db.data.chats[m.chat].language === 'en' ?
`ùó¶ùó¨ùó¶ùóßùóòùó†` 
: 
`ùó¶ùóúùó¶ùóßùóòùó†ùóî`

let sysArch =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ä Ä·¥Ñ ú…™·¥õ·¥á·¥Ñ·¥õ·¥ú Ä·¥á` 
: 
`·¥Ä Ä«´·¥ú…™·¥õ·¥á·¥õ·¥ú Ä·¥Ä`

let sysCPU =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ñ·¥ò·¥ú ·¥ç·¥è·¥Ö·¥á ü` 
: 
`·¥ç·¥è·¥Ö·¥á ü·¥è ·¥Ö·¥á ·¥Ñ·¥ò·¥ú`

let sysCORE =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ñ·¥è Ä·¥ás` 
: 
`…¥·¥úÃÅ·¥Ñ ü·¥á·¥ès`



let cpUsg =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ñ·¥ò·¥ú ·¥ús·¥Ä…¢·¥á` 
: 
`·¥ús·¥è ·¥Ö·¥è ·¥Ñ·¥ò·¥ú`


let creator =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ñ Ä…™·¥Ä·¥Ö·¥è Ä`
:
`·¥Ñ Ä·¥á·¥Ä·¥õ·¥è Ä`

let diskSpace =  global.db.data.chats[m.chat].language === 'en' ?
`·¥Ö…™s·¥ã ·¥ús·¥Ä…¢·¥á` 
: 
`·¥ás·¥ò·¥Ä·¥ÑÃß·¥è ·¥á·¥ç ·¥Ö…™s·¥Ñ·¥è`

let sysLoad =  global.db.data.chats[m.chat].language === 'en' ?
`s ès·¥õ·¥á·¥ç  ü·¥è·¥Ä·¥Ö` 
: 
`C·¥Ä Ä…¢·¥Ä ·¥Ö·¥è S…™s·¥õ·¥á·¥ç·¥Ä`


let systemStats = `ìâò·õúìâù ${systemHeader}
> ·¥ès: ${osPlatform}
>  ú·¥ès·¥õ…¥·¥Ä·¥ç·¥á: robot
> ·¥ú·¥ò·¥õ…™·¥ç·¥á: ${uptime}
> ${sysArch}: ${osInfo.arch}
> ·¥Ö…™s·¥õ Ä·¥è: ${osInfo.distro}
> ·¥ã·¥á Ä…¥·¥á ü: ${osInfo.kernel} (Vers√£o: ${osRelease})
> ${sysCPU}: ${cpuModel}
> ${sysCORE}: ${cpuCore}
> ${cpUsg}: ${cpuPer}%
>  Ä·¥Ä·¥ç: ${formatBytes(memData.total)} total, ${formatBytes(memData.free)} livre (${Math.round(memData.used / memData.total * 100)}% em uso)
> ${diskSpace}: ${formatBytes(fsSize.reduce((acc, curr) => acc + curr.size, 0))} total, ${formatBytes(fsSize.reduce((acc, curr) => acc + curr.used, 0))} usado (${Math.round(fsSize.reduce((acc, curr) => acc + curr.used, 0) / fsSize.reduce((acc, curr) => acc + curr.size, 0) * 100)}% em uso)
> ${sysLoad}: ${systemLoadPercentage}%
`

let message = `${shell}
/// ìâò‚≤ñìâù ${greetTxt} ${name}
> ${project}
> ${creator}: ùõåùêëùêÇùö≤ùêçùêÜùêÑùêãùöØ
> ${botstatus}
${timeActive}
> ‚Äé 
${totalChats}
‚∏∫‚∏∫‚∏∫‚∏∫‚∏∫‚∏∫
> ìâò~ìâù ${groupMetadata.subject}
> // ${groupstatus}
> ‚Äé 
${groupStats}
‚∏∫‚∏∫‚∏∫‚∏∫‚∏∫‚∏∫
${systemStats}
`

await conn.sendFile(m.chat, picture, 'stats.png', message, fkontak)

}
handler.help = ['estado']
handler.tags = ['main']
handler.command = /^(status?)$/i
export default handler

function clockString(ms) {
let h = isNaN(ms) ? '--' : Math.floor(ms / 3600000)
let m = isNaN(ms) ? '--' : Math.floor(ms / 60000) % 60
let s = isNaN(ms) ? '--' : Math.floor(ms / 1000) % 60
return [h, m, s].map(v => v.toString().padStart(2, 0)).join(':')}
